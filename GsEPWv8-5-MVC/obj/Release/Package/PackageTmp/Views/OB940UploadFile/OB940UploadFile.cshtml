@model GsEPWv8_5_MVC.Model.OB940UploadFileModel
@{
    if (Model.uploadLink == "940SPSSRUpload")
    {
        ViewBag.Title = "940 - OB - SPS-TARGET UPLOAD (CSV)";
    }
    else
    {
        ViewBag.Title = "OB SHIPPER 940 SLF PICK ORD Upload";

    }

    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var Ordercount = Model.ListOB940UploadFileHdr.Count;
    var l_int_error_count = Model.ListOB940InvalidData.Count;
    var l_str_allow_940_new_item = Model.allow_940_new_item;
    var l_str_error_desc = Model.error_desc;
    var l_str_rpt_title = Model.uploadLink;
}
<style type="text/css">
    div#ajaxLoading {
        display: none;
        width: 100px;
        height: 100px;
        position: fixed;
        top: 30%;
        left: 56%;
        text-align: center;
        margin-left: -50px;
        margin-top: -100px;
        z-index: 2;
        overflow: auto;
    }

    fieldset {
    
        border: 1px solid silver;
        padding: 8px;
        border-radius: 4px;
    }

    legend {
        padding: 2px;
    }

    legend {
        display: block;
        width: 100%;
        padding: 0;
        margin-bottom: 23px;
        font-size: 14px;
        line-height: inherit;
        color: #e81994;
        border: 0;
        font-weight: bold;
    }

    .fa {
        display: inline-block;
        font: normal normal normal 14px/1 FontAwesome;
        font-size: 12px;
        text-rendering: auto;
        -webkit-font-smoothing: antialiased;
    }

    .ScreenTitle {
        padding-left: 40px;
        font-size: 18px;
        font-family: Verdana;
        font-weight: bold;
        padding-top: 13px;
    }

    .Lblmanual {
        color: #0d8cb5;
        font-family: Trebuchet;
        font-size: 1.8em;
        left: 10px;
        width: 56px;
    }

    .text-muted {
        color: black;
    }

    
    #GridOB940Main tr td:nth-child(1) {
        width: 6%;
    }

    #GridOB940Main tr td:nth-child(2) {
        width: 6%;
    }

    #GridOB940Main tr td:nth-child(3) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(4) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(5) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(6) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(7) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(8) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(9) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(10) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(11) {
        width: 10%;
    }

     #GridOB940Main tr td:nth-child(12) {
        width: 4%;
    }

    #GridOB940Main tr td:nth-child(13) {
        width: 4%;
    }

   
    #GridOB940Main tr td:nth-child(14) {
        width: 16%;
    }

    

</style>
<meta name="viewport" content="width=device-width" />
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/DateTimePicker/jquery.datetimepicker.full.min.js"></script>
<link href="~/Scripts/sweetalert.css" rel="stylesheet" />
<link rel="stylesheet" href="~/plugins/datatables/dataTables.bootstrap.css">
<link href="~/Scripts/ManualSheets/jquery-ui.css" rel="stylesheet" />
<link href="~/Scripts/Style/CommonStyleSheet.css" rel="stylesheet" />
<link href="~/Scripts/DateTimePicker/jquery.datetimepicker.css" rel="stylesheet" />
<table style="width: 100%;">
    <tr>
        <td style="padding-top: 13px;width:10%;">
            @if (System.Configuration.ConfigurationManager.AppSettings["CompanyWebLink"].ToString() == "3plpro.gensoftcorp.com")
            {
                <a href="/DashBoard/DashBoard" id="btnDashboard">
                    <b style="font-size:15px;text-decoration: underline;">Dashboard</b>
                    <i class="fa fa-arrow-circle-right"></i>
                </a>
            }
            @if (System.Configuration.ConfigurationManager.AppSettings["CompanyWebLink"].ToString() == "3plecom.gensoftcorp.com")
            {
                <a href="/ECommDashBoard/ECommDashBoard" id="btnDashboard">
                    <b style="font-size:15px;text-decoration: underline;">Dashboard</b>
                    <i class="fa fa-arrow-circle-right"></i>
                </a>
            }
            @if (System.Configuration.ConfigurationManager.AppSettings["CompanyWebLink"].ToString() == "3plb2b.gensoftcorp.com")
            {
                <a href="/DashBoardB2B/DashBoardB2B" id="btnDashboard">
                    <b style="font-size:15px;text-decoration: underline;">Dashboard</b>
                    <i class="fa fa-arrow-circle-right"></i>
                </a>
            }
        </td>
        @if (l_str_rpt_title == "940SPSSRUpload")
            {
            <td style="width: 60%" class="ScreenTitle">
                OB SHIPPER 940 - SPS-TARGET UPLOAD
                <input type="hidden" id="screenTitle" value="OBShipper940Upload" />
            </td>
        }
        else
        {
            <td style="width: 60%" class="ScreenTitle">
                OB SHIPPER 940 SLF PICK ORD Upload
                <input type="hidden" id="screenTitle" value="OBShipper940Upload" />
            </td>
        }
        
       


        <td style="padding-top: 11px;width:30%;text-align:right">
            @if (System.Configuration.ConfigurationManager.AppSettings["CompanyWebLink"].ToString() == "3plpro.gensoftcorp.com")
            {
                <button type="button" id="btnClose" class="btn-Close">Close</button>
            }
            @if (System.Configuration.ConfigurationManager.AppSettings["CompanyWebLink"].ToString() == "3plecom.gensoftcorp.com")
            {
                <button type="button" id="btnCloseecom" class="btn-Close">Close</button>
            }
            @if (System.Configuration.ConfigurationManager.AppSettings["CompanyWebLink"].ToString() == "3plb2b.gensoftcorp.com")
            {
                <button type="button" id="btnCloseB2B" class="btn-Close">Close</button>
            }
        </td>
    </tr>
</table>
<div id="ajaxLoading" style="display:none;"><img src="~/Images/ajax-loader.gif" /></div>

<div class="box box-default">
    <div class="box-header with-border" style="background-color:#1357d0; padding:5px; ">
        <h6 class="box-title" style="color:white;font-size:16px; font-weight: bolder;">Filter Details</h6>
        <div class="box-tools">
            <input type="button" class="btn btn-box-tool" style="color:white;font-size:11px; font-weight:bold;" value="(Click to hide...)" onclick="return change(this);" data-widget="collapse" title="(Click to hide...)" />
        </div>
    </div>
    <div class="box-body">
        <div class="row" style="margin-bottom:18px;margin-top: 19px;">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="col-md-9 col-sm-9 col-xs-9">
                    <table style="width:100%;border-collapse: separate;border-spacing: 0px 0.5em;">
                        <tr>
                            <td style="text-align: right;  margin-top: 6px;">
                                <label class="Lblmanual"><b>Company: </b></label>
                            </td>
                            <td style="text-align: right;padding-left: 2%;">
                                @Html.DropDownListFor(model => model.cmp_id, new SelectList(Model.ListCompany, "cmp_id", "cmp_name"), "---Select---", new { @class = "form-control" })
                            </td>
                            <td style="text-align: right; width: 120px; margin-top: 6px;">
                                <label class="Lblmanual" style="width: 100%;"><b>File Name: </b></label>
                            </td>
                            <td style="text-align: right;padding-left: 1%;">
                                <input type="file" name="FileUpload" id="upload_file_name" onchange="updateFileName()" style="display:none" title="" />

                                @Html.TextBoxFor(x => x.objOB940UploadFileInfo.file_name, new { @class = "form-control", @name = "file_name", @id = "file_name" })
                            </td>

                            <td style="text-align: left;padding-left: 1%;">
                                <button type="button" style="background-color:#1a45bf" id="btnBrowse" class="btn_browse" onclick="document.getElementById('upload_file_name').click();">Browse</button>
                                <button type="submit" id="btnImport" class="btn_upload">Import </button>
                                <button type="button" id="btnSave" class="btn_Receive" style="width:80px;">Save </button>
                                <button type="reset" id="btnClear" class="btn-Clear">Clear </button>
                            </td>

                        </tr>
                        <tr>
                            <td style="text-align: right;  margin-top: 6px;">
                                <label for="chkIsTransfer" style="font-size:14px;color: #e81994; ">
                                    <input type="checkbox" id="chkIsTransfer"  onclick="chkIsTransferSelect()" />
                                    Is Transfer Order
                                </label>
                            </td>
                            <td style="text-align: right;  margin-top: 6px;">
                                <label class="Lblmanual" id="lblTransfer"><b>Transfer Company: </b></label>
                            </td>
                            <td style="text-align: right;padding-left: 2%;">
                                @Html.DropDownListFor(model => model.cmp_id, new SelectList(Model.ListCompany, "cmp_id", "cmp_name"), "---Select---", new { @id = "transfer_cmp_id", @class = "form-control" , @style = "width:400px;"})
                            </td>
                        </tr>
                    </table>

                    <table style="width:100%;border-collapse: separate;border-spacing: 0px 0.5em;">
                        <tr>
                     
                            <td style="text-align: right;margin-top: 6px;width:6%">
                                <label><b class="Lblmanual">Upload Dt Fm </b></label>
                            </td>
                            <td style="text-align: right;padding-left:1%;width: 6%;">
                                @Html.TextBoxFor(model => model.upload_dt_from, new { @class = "form-control txtlbl", placeholder = "MM/DD/YYYY", @maxlength = "10" })
                            </td>
                            <td style="text-align: right;margin-top: 6px;width:2%">
                                <label><b class="Lblmanual">To</b></label>
                            </td>
                            <td style="text-align: left;padding-left:1%;width: 6%;">
                                @Html.TextBoxFor(model => model.upload_dt_to, new { @class = "form-control txtlbl", placeholder = "MM/DD/YYYY", @maxlength = "10", })
                            </td>

                           
                            <td style="text-align: right;margin-top: 6px;width:4%">
                                <label><b class="Lblmanual">Batch Id </b></label>
                            </td>

                            <td style="width: 10%; padding-left: 1%;text-align: right;">
                                @Html.TextBoxFor(model => model.batch_id, new { @class = "form-control txtlbl", @maxlength = "25",})
                            </td>

                            <td style="text-align: left;width: 10%;padding-left: 2%;">
                                <button type="button" id="btnSearch" class="btn_search">Search </button>
                            </td>
                            <td style="text-align: left; width: 15%; margin-top: 6px;">
                                <a id="upload" href="@Url.Action("SampleTemplatedownload", "OB940UploadFile")" target="_blank" style="text-decoration:underline; color:#4c8cff;"><b style="font-size:13px;">OB SHIPPER 940_SLF PICK-ORD Upload Sample</b></a>

                            </td>

                        </tr>
                    </table>
                </div>
                <div class="col-md-3 col-sm-3 col-xs-3">
                    <table>
                        <tr>
                            <td>
                                <div class="container" style="margin-left:-30px; width:100%;">
                                    <fieldset>
                                        <legend>Report Selection</legend>

                                        <table style="margin-top:-25px;">
                                            <tr>
                                                <td style="padding-left: 10px;font-size: 1.2em;padding-bottom: 8px;"><input type="radio" value="GridSRRpt" name="radio1" checked /><b>SR940 Summary Report</b></td>
                                                <td style="padding-left: 10px;font-size: 1.2em;padding-bottom: 8px;"><input type="radio" value="GridSRExcpRpt" name="radio1" checked /><b>SR940 Exception</b></td>
                                            </tr>
                                        </table>
                                        <table>
                                            <tr>
                                                <td>
                                                    <b style="color:blue;font-size: 12px; margin-left:5px;">Format</b>
                                                    <select id="id_format" class="btn-Format" type="button" style="margin-left:6px;width:70px; text-align:right " data-toggle="dropdown">
                                                      
                                                        <option>XLS</option>
                                                        <option>PDF</option>
                                                    </select>

                                                </td>
                                                <td>
                                                    <b style="color:blue;font-size: 12px; margin-left:20px;">Mode</b>
                                                    <select id="id_mode" class="btn-Format" type="button" style="margin-left:6px; width:90px; text-align:right " data-toggle="dropdown">
                                                        <option>VIEW</option>
                                                        <option>EMAIL</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <button type="button" id="btnprocesss" class="btn_search" style="margin-left:10px; margin-bottom:3px;">Process</button>
                                                </td>

                                            </tr>
                                        </table>
                                    </fieldset>
                                </div>
                            </td>
                        </tr>
                    </table>

                </div>
            </div>
        </div>
      </div>
</div>
<div id="SR940showgrid" class="box-header" style="padding: 5px; background-color: #eee;border-radius: 5px;">
    <div>

        <div>
            <table id="GridOB940Main" class="table table-bordered table-striped" style="border:1px solid #121213 ;width:100%">
                <thead class="grid_backcolor">
                    <tr>
                        <th class="grid_header_backcolor">Ref Num</th>
                        <th class="grid_header_backcolor">Cust PO</th>
                        <th class="grid_header_backcolor">Pick Line</th>
                        <th class="grid_header_backcolor">Style</th>
                        <th class="grid_header_backcolor">Color</th>
                        <th class="grid_header_backcolor">Size</th>
                        <th class="grid_header_backcolor">Cust SKU</th>
                        <th class="grid_header_backcolor">Item Qty</th>
                        <th class="grid_header_backcolor">Ctns</th>
                        <th class="grid_header_backcolor">PPK</th>

                        <th class="grid_header_backcolor">Cube</th>
                        <th class="grid_header_backcolor">Wgt</th>
                        <th class="grid_header_backcolor">Item Name</th>
                        <th class="grid_header_backcolor">Header </th>
                      

                    </tr>
                </thead>

                <tbody>
                    @for (int i = 0; i < Model.ListOB940UploadFileDtl.Count; i++)
                    {
                        var wgt = (Model.ListOB940UploadFileDtl[i].wgt);
                        var cube = (Model.ListOB940UploadFileDtl[i].cube);
                        var l_dec_wgt = wgt.ToString("F2");
                        var l_dec_cube = cube.ToString("F3");
                        <tr class="row-select">
                            <td style="font-size:12px; color:black; font-weight:bold;">@Model.ListOB940UploadFileDtl[i].ref_num</td>
                              <td style="font-size:12px; color:black; font-weight:bold;">@Model.ListOB940UploadFileDtl[i].cust_po_num</td>

                            <td style="font-size:12px; color:black; font-weight:bold;text-align:right">@Model.ListOB940UploadFileDtl[i].pick_line_num</td>
                            <td style="font-size:12px; color:black; font-weight:bold;">@Model.ListOB940UploadFileDtl[i].itm_num</td>
                            <td style="font-size:12px; color:black; font-weight:bold;">@Model.ListOB940UploadFileDtl[i].itm_color</td>
                            <td style="font-size:12px; color:black; font-weight:bold;">@Model.ListOB940UploadFileDtl[i].itm_size</td>

                            <td style="font-size:12px; color:black; font-weight:bold;">@Model.ListOB940UploadFileDtl[i].cust_sku</td>
                            <td style="font-size:12px; color:black; font-weight:bold; text-align:right"> @Model.ListOB940UploadFileDtl[i].ordr_qty</td>
                            <td style="font-size:12px; color:black; font-weight:bold; text-align:right">@Model.ListOB940UploadFileDtl[i].ordr_ctns</td>
                            <td style="font-size:12px; color:black; font-weight:bold; text-align:right">@Model.ListOB940UploadFileDtl[i].ctn_qty</td>

                            <td style="font-size:12px; color:black; font-weight:bold;text-align:right">@l_dec_cube</td>
                            <td style="font-size:12px; color:black; font-weight:bold; text-align:right">@l_dec_wgt</td>
                            <td style="font-size:12px; color:black; font-weight:bold;">@Model.ListOB940UploadFileDtl[i].itm_name</td>
                            <td style="font-size:12px; color:black; font-weight:bold;">@Model.ListOB940UploadFileDtl[i].header_data</td>

                        </tr>
                    }

                </tbody>
            </table>

        </div>
    </div>
</div>

@Html.HiddenFor(model => model.uploadLink, new { @id = "view_upload_link" })

<div id='myModalEmailAlert' class='modal'>
    <div class="modal-dialog">
        <div class="modal-content" style="width: 250%; left:-300px;">
            <div id='myModalEmailAlertContent' style="width: 100%; height: 1000px;"></div>
        </div>
    </div>
</div>

<div id='UsersEmail' class='modal' style="padding-left:947px;padding-top:271px">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 100%;">
            <div id='UsersEmailContent' style="width: 100%; height: 360px;"></div>
        </div>
    </div>
</div>
<script src="~/Scripts/sweetalert.js"></script>
<script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="~/plugins/datatables/dataTables.bootstrap.min.js"></script>


<script type="text/javascript">
    function updateFileName() {
        debugger
        var upload_file_name = document.getElementById('upload_file_name');
        var file_name = document.getElementById('file_name');
        var fileNameIndex = upload_file_name.value.lastIndexOf("\\");
        file_name.value = upload_file_name.value.substring(fileNameIndex + 1);
        $('#btnImport').removeAttr('disabled');
        $('#btnSearch').attr('disabled', 'disabled');
    }

</script>
<script type="text/javascript">

    var file_name = $('#file_name').val();

    $('#btnClear').click(function () {
        $('#file_name').val('');
        $('#upload_file_name').val('');
        $('#ref_num').val('');
        $('#upload_dt_from').val('');
        $('#upload_dt_to').val('');
        var l_str_cmp_id = $('#cmp_id').val();
        $.ajax({
            type: "GET",
            url: '@Url.Content("~/OB940UploadFile/ClearAll")',
            data: {
                "p_str_cmp_id": l_str_cmp_id
            },
            dataType: 'html',
            success: function (result) {

                $("#ajaxLoading").hide();
                $('#SR940showgrid').html("");
                $('#SR940showgrid').html(result);
                $('#btnBrowse').removeAttr('disabled');
            },
            error: function (err) {
                alert(err.statusText);
            }
        });
    });
    $(document).ready(function () {

        $('#btnImport').click(function () {
            debugger
            var l_str_cmp_id = $('#cmp_id').val();
            var l_str_upload_link = $('#view_upload_link').val();
            var l_str_file_name = $('#file_name').val();
            var fileExtension = l_str_file_name.substr((l_str_file_name.lastIndexOf('.') + 1));
            $('#btnSave').removeAttr('disabled');
            $('#btnSearch').attr('disabled', 'disabled');
            if (fileExtension != "csv" && fileExtension != "CSV")
            {
                swal("", "Please Check the File Format, Upload only .CSV File", "");
                $('#file_name').val('');
                $('#upload_file_name').val('');
                $('#SR940showgrid').show();
                return false;

            }
            if (l_str_cmp_id == "") {
                swal("", "please select the company.", "");
                $('#cmp_id').focus();
                $('body,html').animate({ scrolltop: 0 }, 0);
                er = 1;
                return false;
            }
            if (l_str_file_name == "") {
                swal("", "please select the File.", "");
                $('#file_name').focus();
                $('body,html').animate({ scrolltop: 0 }, 0);
                er = 1;
                return false;
            }

            $(document).ready(function () {
                $("#btnSave :input").attr("disabled", false);
            });

            var l_str_cmp_id = $('#cmp_id').val();

            $.ajax({
                type: "GET",
                url: '@Url.Content("~/OB940UploadFile/ClearAll")',
                data: {
                    "p_str_cmp_id": l_str_cmp_id
                },
                dataType: 'html',
                success: function (result) {


                },
                error: function (err) {
                    alert(err.statusText);
                }
            });

            $.ajax({
                type: "GET",
                url: '@Url.Content("~/OB940UploadFile/Check940UploadFileExists")',
                data: {
                    "p_str_cmp_id": l_str_cmp_id, "p_str_file_name": l_str_file_name
                },
                dataType: 'html',
                success: function (e) {
                    debugger
                    $("#ajaxLoading").hide();
                    if (e == "true") {
                        sweetAlert({
                            title: "",
                            text: "File Already Exist, Do you want to Continue?",
                            type: "",
                            showCancelButton: true,
                            confirmButtonClass: "btn-danger",
                            confirmButtonText: "No",
                            cancelButtonText: "Yes",
                            closeOnConfirm: true,
                            closeOnCancel: true
                        },
                    function (isConfirm) {
                        if (isConfirm) {
                        $('#file_name').focus();

                         }

                  else {

                      $("#ajaxLoading").show();
                      if (window.FormData !== undefined) {
                          $('#SR940Errorgrid').html("");
                          $('#SR940showgrid').html("");
                          var fileUpload = $("#upload_file_name").get(0);
                          var files = fileUpload.files;

                          // Create FormData object
                          var fileData = new FormData();

                          // Looping over all files and add it to FormData object
                          for (var i = 0; i < files.length; i++) {
                              fileData.append(files[i].name, files[i]);
                          }

                          // Adding one more key to FormData object
                          fileData.append('username', 'Manas');
                          $("#ajaxLoading").show();
                          $.ajax({
                              url: '/OB940UploadFile/UploadFiles?l_str_cmp_id=' + l_str_cmp_id + '&pstrUploadLink=' + l_str_upload_link,
                              type: "POST",
                              contentType: false, // Not to set any content header
                              processData: false, // Not to process data
                              data: fileData,
                              success: function (result) {
                                  $("#ajaxLoading").hide();
                                  debugger
                                  if (result.error_mode == true) {

                                      $("#error_desc").val(this.error_desc);
                                      $('#SR940Errorgrid').show();
                                      $('#SR940Errorgrid').html("");
                                      $('#SR940Errorgrid').html(this.error_desc);
                                      $("#error_desc").val(this.error_desc);

                                          $("#ajaxLoading").show();
                                          if (window.FormData !== undefined) {

                                              var fileUpload = $("#upload_file_name").get(0);
                                              var files = fileUpload.files;

                                              // Create FormData object
                                              var fileData = new FormData();

                                              // Looping over all files and add it to FormData object
                                              for (var i = 0; i < files.length; i++) {
                                                  fileData.append(files[i].name, files[i]);
                                              }

                                              // Adding one more key to FormData object
                                              fileData.append('username', 'Manas');
                                              $("#ajaxLoading").show();
                                              $.ajax({
                                                  url: '/OB940UploadFile/UploadFiles?l_str_cmp_id=' + l_str_cmp_id + '&pstrUploadLink=' + l_str_upload_link,
                                                  type: "POST",
                                                  contentType: false, // Not to set any content header
                                                  processData: false, // Not to process data
                                                  data: fileData,
                                                  success: function (result) {
                                                      $("#ajaxLoading").hide();
                                                      debugger
                                                      if (result.error_mode == true) {
                                                          $("#error_desc").val(this.error_desc);
                                                          $('#SR940Errorgrid').show();
                                                          $('#SR940Errorgrid').html("");
                                                          $('#SR940Errorgrid').html(this.error_desc);
                                                          $("#error_desc").val(this.error_desc);
                                                          if ((result.error_desc) == "MISMATCH-CMP-ID") {
                                                              swal("", "Company Id Mismatch. Please correct the Company Id and Reupload ", "");
                                                              return false;
                                                          }

                                                      }

                                                      $("#ajaxLoading").hide();
                                                      $('#SR940showgrid').html("");
                                                      $('#SR940showgrid').html(result);
                                                      debugger
                                                      $.ajax({
                                                          type: "GET",
                                                          url: '@Url.Content("~/OB940UploadFile/ErrorDescCount")',
                                                          contentType: "application/json; charset=utf-8",
                                                          data: "",
                                                          datatype: "json",
                                                          success: function (result) {
                                                              debugger

                                                              if (result == "true") {
                                                                  swal("", "Exception found.Please correct the File and Reupload ", "");
                                                                  return false;
                                                              }
                                                          },
                                                          error: function (err) {
                                                              swal(err.statusText);
                                                          }
                                                      });

                                                  },
                                                  error: function (err) {
                                                      swal(err.statusText);
                                                  }
                                              });

                                          } else {
                                              swal("FormData is not supported.");
                                          }
                                      }


                                  else {

                                      $("#ajaxLoading").hide();
                                      $('#SR940showgrid').html("");
                                      $('#SR940showgrid').html(result);
                                  }


                              },
                              error: function (err) {
                                  swal(err.statusText);
                              }
                          });

                      } else {
                          swal("FormData is not supported.");
                      }
                  }
              });


                    }
                    else {
                        if (window.FormData !== undefined) {

                            var fileUpload = $("#upload_file_name").get(0);
                            var files = fileUpload.files;

                            // Create FormData object
                            var fileData = new FormData();

                            // Looping over all files and add it to FormData object
                            for (var i = 0; i < files.length; i++) {
                                fileData.append(files[i].name, files[i]);
                            }

                            // Adding one more key to FormData object
                            fileData.append('username', 'Manas');
                            $("#ajaxLoading").show();
                            $.ajax({
                                url: '/OB940UploadFile/UploadFiles?l_str_cmp_id=' + l_str_cmp_id + '&pstrUploadLink=' + l_str_upload_link,
                                type: "POST",
                                contentType: false, // Not to set any content header
                                processData: false, // Not to process data
                                data: fileData,
                                success: function (result) {
                                    $("#ajaxLoading").hide();
                                    debugger
                                    if (result.error_mode == true) {

                                        $("#error_desc").val(this.error_desc);
                                        $('#SR940Errorgrid').show();
                                        $('#SR940Errorgrid').html("");
                                        $('#SR940Errorgrid').html(result);
                                        $('#SR940Errorgrid').html(this.error_desc);
                                        $("#error_desc").val(this.error_desc);
                                        if ((result.error_desc) == "MISMATCH-CMP-ID") {
                                            swal("", "Company Id Mismatch. Please correct the Company Id and Reupload ", "");
                                            return false;
                                        }

                                        if (result.Error_flag = "O") {
                                            swal("", "Exception found.Please correct the File and Reupload ", "");
                                            return false;
                                        }

                                    }
                                    else {

                                        $("#ajaxLoading").hide();
                                        $('#SR940showgrid').html("");
                                        $('#SR940showgrid').html(result);
                                    }

                                    debugger


                                },
                                error: function (err) {
                                    swal(err.statusText);
                                }
                            });
                        } else {
                            swal("FormData is not supported.");
                        }
                    }
                },

            })

        });
    });


    $("#btnClose").click(function () {

        window.location.href = '@Url.Action("Dashboard", "DashBoard")';
    })

    $("#btnCloseecom").click(function () {

        window.location.href = '@Url.Action("ECommDashBoard", "ECommDashBoard")';
    })

    $("#btnCloseB2B").click(function () {
        debugger
        var p_str_screentitle = $('#screentitle').val();
        var p_str_cmpid = $('#g_str_tmp_cmp_id').val();
        var url = '@Url.Action("DashboardB2B", "DashboardB2B")';
        url += '?id=' + p_str_cmpid;
        window.location.href = url;
    })

    $("#btnSave").click(function () {
        debugger
        var x = document.getElementById("GridOB940Main").rows.length;
        var l_int_error_count = $("#l_int_error_count").val();
        var l_str_allow_940_new_item = $("#l_str_allow_940_new_item").val();
        var inttyleError = 0;
        if (l_int_error_count != 0 ) {
            if (l_str_allow_940_new_item == "1")
            {
                var refTab = document.getElementById("GridEcomSR940Error");
                for (var i = 1; i < refTab.rows.length; i++) {
                    var colVal = refTab.rows.item(i).cells.item(3);
                    if (refTab.rows[i].cells[3].innerHTML.includes("STYLE NOT FOUND") == true) {
                        inttyleError = inttyleError + 1;
                    }
                }

                if (l_int_error_count - inttyleError > 0) {
                    swal("", "Exception found.Please correct the File and Reupload ", "");
                    return false;
                }
            }
            else
            {
                swal("", "Exception found.Please correct the File and Reupload ", "");
                return false;
            }
            
        }

       


        $('#btnSearch').attr('disabled', 'disabled');


        var rowCount = $("#GridOB940Main td").closest("tr").length;
        if ((rowCount == 0 || rowCount == null) && (inttyleError == 0)) {
            swal("", "No Record found to save", "");
            return false;
        }

        $("#ajaxLoading").show();
        var p_str_cmp_id = $('#cmp_id').val();
        var pstrTransferCmpId = $('#transfer_cmp_id').val();
        var lchkIsTransfer = document.getElementById("chkIsTransfer");
        if (lchkIsTransfer.checked)
        {
            if (p_str_cmp_id == pstrTransferCmpId)
            {
                swal("", "Transfer Company can not be same as Operational Company.", "");
                $('#transfer_cmp_id').focus();
                $('body,html').animate({ scrollTop: 0 }, 0);
                er = 1;
                $("#ajaxLoading").hide();
                return false;
            }
        }
        else
        {
            pstrTransferCmpId = "";
        }

        var p_str_file_name = $('#file_name').val();

        if (p_str_cmp_id == "") {
            swal("", "Please Select The Company.", "");
            $('#cmp_id').focus();
            $('body,html').animate({ scrollTop: 0 }, 0);
            er = 1;
            return false;
        }
        else {
            $.ajax({
                type: "GET",
                url: '@Url.Content("~/OB940UploadFile/SaveOB940UploadFile")',
                data: {
                    "p_str_cmp_id": p_str_cmp_id, "p_str_file_name": p_str_file_name, "pstrTransferCmpId": pstrTransferCmpId
                },
                dataType: 'html',
                success: function (e) {
                    debugger
                    var obj = JSON.parse(e);
                    var l_str_error_desc = obj.error_desc;
                    var email_auto_sent = obj.email_auto_sent;

                    if (l_str_error_desc != "NO") {
                        $("#ajaxLoading").hide();
                        swal("", l_str_error_desc, "");
                        return false;
                    }


                    if (e.error_mode == "true") {
                        $("#ajaxLoading").hide();
                        swal("", "Exception found.Please correct the File and Reupload ", "");
                        return false;
                    }


                    $("#ajaxLoading").hide();


                    if (email_auto_sent == "N") {
                    sweetAlert({
                        title: "",
                        text: " Ship Request 940  uploaded successfully. Do you want to Send Acknowledgement mail",
                        type: "",
                        showCancelButton: true,
                        confirmButtonClass: "btn-danger",
                        confirmButtonText: "Yes",
                        cancelButtonText: "No",
                        closeOnConfirm: true,
                        closeOnCancel: true
                    },
                        function (isConfirm) {
                            if (isConfirm)
                            {
                                var TeamDetailPostemailBackURL = '/OB940UploadFile/Send940SRExcelReport';
                                var options = { "backdrop": "static", keyboard: true };

                                var p_str_filename = $('#file_name').val();
                                var p_str_cmpid = $('#cmp_id').val();
                                var p_str_so_dt_frm = $('#so_dtFm').val();
                                var p_str_so_dt_to = $('#so_dtTo').val();
                                var p_str_batch_id = $('#batch_id').val();
                                $("#ajaxLoading").show();
                                $.ajax({
                                    type: "GET",
                                    url: TeamDetailPostemailBackURL,
                                    contentType: "application/json; charset=utf-8",
                                    data: {
                                        "p_str_cmpid": p_str_cmpid, "p_str_filename": p_str_filename,
                                        "p_str_so_dt_frm": p_str_so_dt_frm, "p_str_so_dt_to": p_str_so_dt_to
                                        , "p_str_batch_id": p_str_batch_id
                                        },
                                    datatype: "json",
                                    success: function (data) {
                                        //alert("hjk")
                                        debugger;
                                        $("#ajaxLoading").hide();
                                        $('#myModalEmailAlertContent').html(data);
                                        $('#myModalEmailAlert').modal(options);
                                        $('#myModalEmailAlert').modal('show');

                                        $("#ajaxLoading").hide();
                                        $('#SR940showgrid').html("");
                                        $('#SR940showgrid').html(result);
                                        $("#btnSave :input").attr("disabled", false);


                                    },
                                    error: function () {
                                        alert("Dynamic content load failed.");
                                    }
                                });


                            }
                            else {

                                setTimeout(function () {
                                    var p_str_cmpid = $('#cmp_id').val();
                                    var type = "PDF";

                                    window.open('ShowReport?p_str_cmpid=' + p_str_cmpid + '&type=' + type, 'OB940UploadFile', "toolbar=no, scrollbars=yes, resizable=yes, top=200, left=500, width=950, height=700", 'ShowReport');
                                    window.location.href = '@Url.Action("OB940UploadFile", "OB940UploadFile")';
                                    $('#btnSearch').removeAttr('disabled');

                                });

                            }
                        });
                    }

                    else
                    {
                        var TeamDetailPostemailBackURL = '/OB940UploadFile/Send940SRExcelReport';
                        var options = { "backdrop": "static", keyboard: true };

                        var p_str_filename = $('#file_name').val();
                        var p_str_cmpid = $('#cmp_id').val();
                        var p_str_so_dt_frm = $('#so_dtFm').val();
                        var p_str_so_dt_to = $('#so_dtTo').val();
                        var p_str_batch_id = $('#batch_id').val();
                        $("#ajaxLoading").show();
                        $.ajax({
                            type: "GET",
                            url: TeamDetailPostemailBackURL,
                            contentType: "application/json; charset=utf-8",
                            data: {
                                "p_str_cmpid": p_str_cmpid, "p_str_filename": p_str_filename,
                                "p_str_so_dt_frm": p_str_so_dt_frm, "p_str_so_dt_to": p_str_so_dt_to
                                , "p_str_batch_id": p_str_batch_id
                            },
                            datatype: "json",
                            success: function (data) {
                                debugger;
                                $("#ajaxLoading").hide();
                                $('#myModalEmailAlertContent').html(data);
                                $('#myModalEmailAlert').modal(options);
                                $('#myModalEmailAlert').modal('show');

                                $("#ajaxLoading").hide();
                                $('#SR940showgrid').html("");
                                $('#SR940showgrid').html(result);
                                $("#btnSave :input").attr("disabled", false);


                            },
                            error: function () {
                                alert("Dynamic content load failed.");
                            }
                        });
                    }

                },

            })
        }
    });

    $("#btnDashboard").click(function () {
        var p_str_cmpid = $('#cmp_id').val();
        var url = '@Url.Action("Dashboard", "Dashboard")';
        url += '?id=' + p_str_cmpid;
        window.location.href = url;

    })

    $('#so_dtFm').datetimepicker({
        timepicker: false,
        step: 15, format: 'm-d-Y'
    });
    $('#so_dtTo').datetimepicker({
        timepicker: false,
        step: 15, format: 'm-d-Y'
    });

</script>

<script type="text/javascript">
    $("#btnprocesss").click(function () {
        debugger
        var getFormat = $('#id_format').find(":selected").text();
        var getMode = $('#id_mode').find(":selected").text();
        if (getFormat == 'PDF' && getMode == 'VIEW') {
            debugger

            {
                var SelectedRow = [];
                var checkboxIDArray = [];
                var type = "PDF"
                var var_name = $("input[name='radio1']:checked").val();
                if (var_name == "GridSRRpt") {
                    var p_str_cmpid = $('#cmp_id').val();
                    var p_str_filename = $('#file_name').val();
                    var p_str_so_dt_frm = $('#upload_dt_from').val();
                    var p_str_so_dt_to = $('#upload_dt_to').val();
                    var p_str_batch_id = $('#batch_id').val();
                    window.open('Show940SRReport?p_str_cmpid=' + p_str_cmpid + '&p_str_filename=' + p_str_filename +
                        '&p_str_so_dt_frm=' + p_str_so_dt_frm + '&p_str_so_dt_to=' + p_str_so_dt_to + '&p_str_batch_id=' + p_str_batch_id, 'OB940UploadFile', "toolbar=no, scrollbars=yes, resizable=yes, top=200, left=500, width=950, height=700", 'Show940SRReport?var_name=' + var_name);
                }
            }
        }

        else if (getFormat == 'XLS' && getMode == 'VIEW') {
            debugger
            {
                var SelectedRow = [];
                var checkboxIDArray = [];
                var type = "XLS"
                var var_name = $("input[name='radio1']:checked").val();
                if (var_name == "GridSRRpt") {
                    var p_str_cmpid = $('#cmp_id').val();
                    var p_str_filename = $('#file_name').val();
                    var p_str_so_dt_frm = $('#upload_dt_from').val();
                    var p_str_so_dt_to = $('#upload_dt_to').val();
                    var p_str_batch_id = $('#batch_id').val();
                    window.location.replace("/OB940UploadFile/Show940SRExcelReport?p_str_cmpid=" + p_str_cmpid + '&p_str_filename=' + p_str_filename +
                        '&p_str_so_dt_frm=' + p_str_so_dt_frm + '&p_str_so_dt_to=' + p_str_so_dt_to + '&p_str_batch_id=' + p_str_batch_id)
                }

                else if (var_name == "GridSRExcpRpt") {
                    var p_str_cmpid = $('#cmp_id').val();
                    var p_str_filename = $('#file_name').val();
                    var p_str_so_dt_frm = $('#upload_dt_from').val();
                    var p_str_so_dt_to = $('#upload_dt_to').val();
                    var p_str_batch_id = $('#batch_id').val();
                    window.location.replace("/OB940UploadFile/Show940SRExcpExcelReport?p_str_cmpid=" + p_str_cmpid + '&p_str_filename=' + p_str_filename +
                        '&p_str_so_dt_frm=' + p_str_so_dt_frm + '&p_str_so_dt_to=' + p_str_so_dt_to + '&p_str_batch_id=' + p_str_batch_id)
                }

                

            }
        }
        else if (getFormat == 'PDF' && getMode == 'EMAIL') {
            debugger
            {
                var TeamDetailPostemailBackURL = '/OB940UploadFile/Send940EmailAckReport';
                var options = { "backdrop": "static", keyboard: true };
                var SelectedRow = [];
                var checkboxIDArray = [];
                var type = "PDF"
                var var_name = $("input[name='radio1']:checked").val();
                if (var_name == "GridSRRpt") {
                    var p_str_cmp_id = $('#cmp_id').val();
                    var p_str_file_name = $('#file_name').val();
                    var p_str_batch_id = $('#batch_id').val();
                    $("#ajaxLoading").show();
                    $.ajax({
                        type: "GET",
                        url: TeamDetailPostemailBackURL,
                        contentType: "application/json; charset=utf-8",
                        data: {
                            "p_str_cmp_id": p_str_cmp_id
                            , "p_str_file_name": p_str_file_name, "p_str_batch_id": p_str_batch_id
                           
                        },
                        datatype: "json",
                        success: function (data) {
                            debugger;
                            $("#ajaxLoading").hide();
                            $('#myModalEmailAlertContent').html(data);
                            $('#myModalEmailAlert').modal(options);
                            $('#myModalEmailAlert').modal('show');

                        },
                        error: function () {
                            alert("Dynamic content load failed.");
                        }
                    });
                }
            }
        }
        else if (getFormat == 'XLS' && getMode == 'EMAIL') {
            debugger
            {
                var TeamDetailPostemailBackURL = '/OB940UploadFile/Send940SRExcelReport';
                var options = { "backdrop": "static", keyboard: true };
                var SelectedRow = [];
                var checkboxIDArray = [];
                var type = "PDF"
                var var_name = $("input[name='radio1']:checked").val();
                if (var_name == "GridSRRpt") {
                    var p_str_cmpid = $('#cmp_id').val();
                    var p_str_filename = $('#file_name').val();
                    var p_str_so_dt_frm = $('#so_dtFm').val();
                    var p_str_so_dt_to = $('#so_dtTo').val();
                    var p_str_batch_id = $('#batch_id').val();
                    $("#ajaxLoading").show();
                    $.ajax({
                        type: "GET",
                        url: TeamDetailPostemailBackURL,
                        contentType: "application/json; charset=utf-8",
                        data: {
                            "p_str_cmpid": p_str_cmpid, "p_str_filename": p_str_filename, 
                            "p_str_so_dt_frm": p_str_so_dt_frm, "p_str_so_dt_to": p_str_so_dt_to
                            , "p_str_batch_id": p_str_batch_id
                        },
                        datatype: "json",
                        success: function (data) {
                            //alert("hjk")
                            debugger;
                            $("#ajaxLoading").hide();
                            $('#myModalEmailAlertContent').html(data);
                            $('#myModalEmailAlert').modal(options);
                            $('#myModalEmailAlert').modal('show');

                        },
                        error: function () {
                            alert("Dynamic content load failed.");
                        }
                    });
                }
            }
        }
    })
</script>

<script>
    function chkIsTransferSelect() {

        var lchkIsTransfer = document.getElementById("chkIsTransfer");
        if (lchkIsTransfer.checked)
        {
            document.getElementById('transfer_cmp_id').style.display = 'inline';
            document.getElementById('lblTransfer').style.display = "inline";
        } else
        {
            document.getElementById('transfer_cmp_id').style.display = "none";
            document.getElementById('lblTransfer').style.display = "none";
            
        }
    }

    $(document).ready(function () {
        document.getElementById('transfer_cmp_id').style.display = "none";
        document.getElementById('lblTransfer').style.display = "none";
    });

</script>